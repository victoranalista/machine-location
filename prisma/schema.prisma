generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  USER
  SUPPLIER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum EquipmentStatus {
  AVAILABLE
  RENTED
  MAINTENANCE
  UNAVAILABLE
}

enum RentalStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
  FAILED
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified DateTime?
  name          String?
  password      String?
  image         String?
  role          Role      @default(USER)
  status        UserStatus @default(ACTIVE)
  phone         String?
  company       String?
  document      String?
  address       String?
  city          String?
  state         String?
  zipCode       String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  accounts      Account[]
  sessions      Session[]
  rentals       Rental[]
  favorites     Favorite[]
  reviews       Review[]
  notifications Notification[]
  cartItems     CartItem[]
  ownedEquipment Equipment[] @relation("OwnedEquipment")

  @@index([email])
  @@index([role])
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model UserHistory {
  id        String     @id @default(cuid())
  email     String
  name      String
  password  String?
  role      Role       @default(USER)
  status    UserStatus @default(ACTIVE)
  phone     String?
  company   String?
  document  String?
  address   String?
  city      String?
  state     String?
  zipCode   String?
  version   Int        @default(1)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@index([email, status])
  @@index([email, version])
}

model Category {
  id          String      @id @default(cuid())
  name        String      @unique
  slug        String      @unique
  description String?
  icon        String?
  imageUrl    String?
  parentId    String?
  parent      Category?   @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[]  @relation("CategoryHierarchy")
  equipment   Equipment[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([slug])
  @@index([parentId])
}

model Brand {
  id        String      @id @default(cuid())
  name      String      @unique
  slug      String      @unique
  logoUrl   String?
  website   String?
  equipment Equipment[]
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@index([slug])
}

model Equipment {
  id                String          @id @default(cuid())
  name              String
  slug              String          @unique
  description       String
  shortDescription  String?
  categoryId        String
  category          Category        @relation(fields: [categoryId], references: [id])
  brandId           String?
  brand             Brand?          @relation(fields: [brandId], references: [id])
  model             String?
  year              Int?
  status            EquipmentStatus @default(AVAILABLE)
  dailyRate         Decimal         @db.Decimal(10, 2)
  weeklyRate        Decimal?        @db.Decimal(10, 2)
  monthlyRate       Decimal?        @db.Decimal(10, 2)
  minRentalDays     Int             @default(1)
  maxRentalDays     Int?
  depositAmount     Decimal?        @db.Decimal(10, 2)
  operatingWeight   Decimal?        @db.Decimal(10, 2)
  enginePower       String?
  fuelType          String?
  capacity          String?
  dimensions        String?
  features          String[]
  mainImageUrl      String?
  location          String?
  city              String?
  state             String?
  latitude          Decimal?        @db.Decimal(10, 8)
  longitude         Decimal?        @db.Decimal(11, 8)
  availableFrom     DateTime?
  availableTo       DateTime?
  viewCount         Int             @default(0)
  featured          Boolean         @default(false)
  isApproved        Boolean         @default(false)
  ownerId           String
  owner             User            @relation("OwnedEquipment", fields: [ownerId], references: [id])
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  images      EquipmentImage[]
  specs       EquipmentSpec[]
  rentals     Rental[]
  favorites   Favorite[]
  reviews     Review[]
  cartItems   CartItem[]

  @@index([slug])
  @@index([categoryId])
  @@index([brandId])
  @@index([status])
  @@index([city, state])
  @@index([featured])
  @@index([ownerId])
  @@index([isApproved])
}

model EquipmentImage {
  id          String    @id @default(cuid())
  equipmentId String
  equipment   Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
  url         String
  alt         String?
  isPrimary   Boolean   @default(false)
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())

  @@index([equipmentId])
}

model EquipmentSpec {
  id          String    @id @default(cuid())
  equipmentId String
  equipment   Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
  name        String
  value       String
  unit        String?
  sortOrder   Int       @default(0)
  createdAt   DateTime  @default(now())

  @@index([equipmentId])
}

model Rental {
  id             String        @id @default(cuid())
  rentalNumber   String        @unique @default(cuid())
  userId         String
  user           User          @relation(fields: [userId], references: [id])
  equipmentId    String
  equipment      Equipment     @relation(fields: [equipmentId], references: [id])
  startDate      DateTime
  endDate        DateTime
  totalDays      Int
  dailyRate      Decimal       @db.Decimal(10, 2)
  subtotal       Decimal       @db.Decimal(10, 2)
  deliveryFee    Decimal?      @db.Decimal(10, 2)
  insuranceFee   Decimal?      @db.Decimal(10, 2)
  discount       Decimal?      @db.Decimal(10, 2)
  total          Decimal       @db.Decimal(10, 2)
  depositAmount  Decimal?      @db.Decimal(10, 2)
  depositPaid    Boolean       @default(false)
  status         RentalStatus  @default(PENDING)
  paymentStatus  PaymentStatus @default(PENDING)
  deliveryAddress String?
  deliveryCity   String?
  deliveryState  String?
  deliveryZip    String?
  deliveryNotes  String?
  pickupAddress  String?
  pickupCity     String?
  pickupState    String?
  pickupZip      String?
  pickupNotes    String?
  notes          String?
  cancelReason   String?
  cancelledAt    DateTime?
  confirmedAt    DateTime?
  startedAt      DateTime?
  completedAt    DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@index([userId])
  @@index([equipmentId])
  @@index([status])
  @@index([startDate, endDate])
  @@index([rentalNumber])
}

model Favorite {
  id          String    @id @default(cuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  equipmentId String
  equipment   Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now())

  @@unique([userId, equipmentId])
  @@index([userId])
  @@index([equipmentId])
}

model Review {
  id          String    @id @default(cuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  equipmentId String
  equipment   Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
  rating      Int
  title       String?
  comment     String?
  isVerified  Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@unique([userId, equipmentId])
  @@index([equipmentId])
  @@index([rating])
}

model CartItem {
  id          String    @id @default(cuid())
  sessionId   String
  userId      String?
  user        User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  equipmentId String
  equipment   Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
  startDate   DateTime
  endDate     DateTime
  quantity    Int       @default(1)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@unique([sessionId, equipmentId])
  @@index([sessionId])
  @@index([userId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  title     String
  message   String
  type      String
  read      Boolean     @default(false)
  link      String?
  createdAt DateTime    @default(now())

  @@index([userId])
  @@index([read])
}

model Location {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  city      String
  state     String
  country   String   @default("Brasil")
  zipCode   String?
  address   String?
  latitude  Decimal? @db.Decimal(10, 8)
  longitude Decimal? @db.Decimal(11, 8)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([city, state])
  @@index([slug])
  @@index([state])
}

model PageContent {
  id        String   @id @default(cuid())
  slug      String   @unique
  title     String
  content   String
  metaTitle String?
  metaDesc  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
}
